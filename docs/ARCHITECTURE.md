# ğŸ—ï¸ casto ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ãƒ¦ãƒ¼ã‚¶ãƒ¼      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚ Next.js  â”‚ (apps/web)
    â”‚ Frontend â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Cloudflare    â”‚ (apps/workers)
    â”‚ Workers API   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚ Supabase â”‚
    â”‚ Database â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## APIé…ç½®æ–¹é‡

### Cloudflare Workers (`apps/workers/src/features/`)
- **ç”¨é€”**: æ±ç”¨APIã€èªè¨¼ã€æ±ºæ¸ˆãªã©å¤–éƒ¨å…¬é–‹ãŒå¿…è¦ãªå‡¦ç†
- **ç‰¹å¾´**: ç‹¬ç«‹ã—ãŸAPIã‚µãƒ¼ãƒãƒ¼ã€è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå¯¾å¿œã€ã‚¨ãƒƒã‚¸é…ä¿¡
- **æ§‹æˆ**: æ©Ÿèƒ½ã”ã¨ã« `features/<name>/routes.ts` ã§å®Ÿè£…

### Next.js Route Handlers (`apps/web/src/app/api/`)
- **ç”¨é€”**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å°‚ç”¨ã®è»½é‡å‡¦ç†ã€SSRç”¨ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ
- **ç‰¹å¾´**: Next.jsã¨åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§å®Œçµã€å†…éƒ¨APIå‘ã‘
- **æ–¹é‡**: ç¾çŠ¶ã¯æœªä½¿ç”¨ã€å¿…è¦ã«å¿œã˜ã¦å¾Œã‹ã‚‰è¿½åŠ 

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ â†’ Workers API â†’ Supabase
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ Workers API çµŒç”±ã§ãƒ‡ãƒ¼ã‚¿å–å¾—
- Supabase ã¸ã®ç›´æ¥æ¥ç¶šã¯è¡Œã‚ãªã„ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»æ¨©é™ç®¡ç†ã®ä¸€å…ƒåŒ–ï¼‰
- `NEXT_PUBLIC_API_BASE_URL` ã§ Workers ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‚ç…§

### Workers â†’ Supabase
- `SUPABASE_SERVICE_ROLE_KEY` ã§ã‚µãƒ¼ãƒãƒ¼å´ã‹ã‚‰æ¥ç¶š
- RLS ã¯ `USING (false)` ã§ç¶­æŒã—ã€Service Role ã®ã¿æ“ä½œå¯èƒ½

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (`apps/web/src/`)
```
app/
  liff/           # LINE ãƒŸãƒ‹ã‚¢ãƒ—ãƒª
  test/           # é–‹ç™ºãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸
components/
  common/         # å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  <feature>/      # æ©Ÿèƒ½åˆ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
hooks/
  common/         # å…±é€šã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
  <feature>/      # æ©Ÿèƒ½åˆ¥ãƒ•ãƒƒã‚¯
lib/              # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
```

### API (`apps/workers/src/`)
```
app.ts            # Honoã‚¢ãƒ—ãƒªæœ¬ä½“ï¼ˆCORSãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
index.ts          # ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
config/
  env.ts          # ç’°å¢ƒè¨­å®šï¼ˆdevelopment/productionï¼‰
features/
  <feature>/
    routes.ts     # API endpoints
    service.ts    # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
lib/              # æ±ç”¨ã‚¤ãƒ³ãƒ•ãƒ©ï¼ˆauthãƒ»supabaseç­‰ï¼‰
middleware/       # èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
types/
  index.ts        # å‹ã®re-export
  bindings.ts     # Hono Bindings
  supabase.ts     # ãƒ‰ãƒ¡ã‚¤ãƒ³å‹
```

## å‘½åè¦å‰‡

- **æ©Ÿèƒ½åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«**: ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§çµ±ä¸€ï¼ˆä¾‹: `TestUserTable.tsx`, `useTestUsers.ts`ï¼‰
- **å…±é€šãƒ•ã‚¡ã‚¤ãƒ«**: æ©Ÿèƒ½åã®ã¿ï¼ˆä¾‹: `DataTable.tsx`, `usePagination.ts`ï¼‰
- **ä¾å­˜æ–¹å‘**: `<feature>/` â†’ `common/` ã¯å¯ã€é€†ã¯ç¦æ­¢

---

**æœ€çµ‚æ›´æ–°**: 2025/10/01
