# ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚¬ã‚¤ãƒ‰

## ğŸ¯ åŸºæœ¬æ–¹é‡

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ« = çœŸå®Ÿã®æº

```
supabase/migrations/*.sqlï¼ˆGitç®¡ç†ï¼‰
  â†“ make migrate
ãƒªãƒ¢ãƒ¼ãƒˆDBï¼ˆSupabaseï¼‰
  â†“ make generate-schema
ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ã‚­ãƒ¼ãƒï¼ˆschema.json, types.ts, SCHEMA.mdï¼‰
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒã™ã¹ã¦ã®å¤‰æ›´å±¥æ­´
- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ã‚­ãƒ¼ãƒã¯è‡ªå‹•ç”Ÿæˆï¼ˆGitã«ã¯å«ã‚ãªã„ï¼‰
- å‹å®‰å…¨æ€§ã‚’ä¿ã¤ãŸã‚ã«TypeScriptå‹å®šç¾©ã‚’ç”Ÿæˆ

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
supabase/
â”œâ”€â”€ migrations/                    # Gitç®¡ç† âœ…
â”‚   â”œâ”€â”€ 20250130_001_create_users.sql
â”‚   â”œâ”€â”€ 20250130_002_create_applicant_profiles.sql
â”‚   â””â”€â”€ 20250130_003_create_viewing_history.sql
â”œâ”€â”€ schema.json                    # è‡ªå‹•ç”Ÿæˆï¼ˆGitignoreï¼‰
â”œâ”€â”€ types.ts                       # è‡ªå‹•ç”Ÿæˆï¼ˆGitignoreï¼‰
â””â”€â”€ SCHEMA.md                      # è‡ªå‹•ç”Ÿæˆï¼ˆGitignoreï¼‰
```

---

## ğŸ”„ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆã‚’ç¢ºèª

```bash
# ã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆï¼ˆæœ€æ–°ã®çŠ¶æ…‹ã‚’å–å¾—ï¼‰
make generate-schema

# ç¢ºèªæ–¹æ³•1: JSONå½¢å¼
cat supabase/schema.json

# ç¢ºèªæ–¹æ³•2: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå½¢å¼
cat supabase/SCHEMA.md

# ç¢ºèªæ–¹æ³•3: TypeScriptå‹å®šç¾©
cat supabase/types.ts
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- âœ… æ¯å›DBã«æ¥ç¶šä¸è¦
- âœ… å‹å®šç¾©ã§ã‚³ãƒ¼ãƒ‰è£œå®ŒãŒåŠ¹ã
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦å…±æœ‰å¯èƒ½

---

### 2. æ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ 

```bash
# 1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
vim supabase/migrations/20250131_001_create_auditions.sql

# 2. é©ç”¨
make migrate

# 3. ã‚¹ã‚­ãƒ¼ãƒæ›´æ–°
make generate-schema

# 4. Gitç®¡ç†
git add supabase/migrations/20250131_001_create_auditions.sql
git commit -m "feat: add auditions table"
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚’Gitç®¡ç†
- ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã¯è‡ªå‹•ç”Ÿæˆãªã®ã§Gitignore

---

### 3. ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒåŒæœŸ

```bash
# 1. æœ€æ–°ã‚’å–å¾—
git pull

# 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
make migrate

# 3. ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ã‚­ãƒ¼ãƒæ›´æ–°
make generate-schema
```

---

## ğŸ“Š ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### âœ… æ¨å¥¨: å°ã•ãé »ç¹ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```
âŒ ãƒ€ãƒ¡ãªä¾‹:
migrations/
â””â”€â”€ 20250130_big_update.sql  (500è¡Œã€10ãƒ†ãƒ¼ãƒ–ãƒ«)

âœ… è‰¯ã„ä¾‹:
migrations/
â”œâ”€â”€ 20250130_001_create_users.sql
â”œâ”€â”€ 20250130_002_create_profiles.sql
â”œâ”€â”€ 20250130_003_add_avatar_column.sql
â””â”€â”€ 20250131_001_create_auditions.sql
```

**ç†ç”±:**
- å¤‰æ›´å±¥æ­´ãŒæ˜ç¢º
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã‚„ã™ã„
- ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã‚„ã™ã„
- ç«¶åˆã—ã«ãã„

---

### âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã—ãªã„

```
âŒ ãƒ€ãƒ¡:
rm supabase/migrations/20250130_001_create_users.sql

âœ… æ­£ã—ã„:
# æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å¤‰æ›´
vim supabase/migrations/20250131_002_drop_old_column.sql
```

**ç†ç”±:**
- å¤‰æ›´å±¥æ­´ãŒæ¶ˆãˆã‚‹
- ä»–ã®ãƒ¡ãƒ³ãƒãƒ¼ã®ç’°å¢ƒãŒå£Šã‚Œã‚‹
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ããªããªã‚‹

---

### âœ… æœ¬ç•ªé©ç”¨å‰ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã‚’ç”¨æ„

```sql
-- 20250131_001_create_auditions.sql
CREATE TABLE auditions (...);

-- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼ˆåˆ¥é€”ä½œæˆï¼‰
-- 20250131_999_rollback_auditions.sql
DROP TABLE IF EXISTS auditions CASCADE;
```

---

## ğŸ¯ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤šããªã£ãŸã‚‰ï¼Ÿ

### æ–¹æ³•1: ã‚¹ã‚­ãƒ¼ãƒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ˆæ¨å¥¨ï¼‰

å®šæœŸçš„ã«ã€Œç¾åœ¨ã®å…¨ä½“ã‚¹ã‚­ãƒ¼ãƒã€ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆï¼š

```bash
# åŠå¹´ã«1å›ãªã©
vim supabase/migrations/20250630_000_schema_snapshot.sql

# å†…å®¹: ã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®CREATEæ–‡
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- æ–°è¦ãƒ¡ãƒ³ãƒãƒ¼ã¯æœ€æ–°ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰é–‹å§‹
- å¤ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã™ã‚‹å¿…è¦ãŒãªã„
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚é–“ãŒçŸ­ç¸®

---

### æ–¹æ³•2: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•´ç†

```
supabase/migrations/
â”œâ”€â”€ archive/                      # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼ˆå‚ç…§ç”¨ï¼‰
â”‚   â””â”€â”€ 2025_01_deprecated/
â”‚       â”œâ”€â”€ 20250130_001_old.sql
â”‚       â””â”€â”€ 20250130_002_old.sql
â””â”€â”€ 20250630_000_schema_snapshot.sql  # æœ€æ–°ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
```

---

## ğŸ’¡ å®Ÿé‹ç”¨ã§ã®ç®¡ç†

### é–‹ç™ºç’°å¢ƒã§ã®é‹ç”¨

```bash
# 1. æ¯æœ: æœ€æ–°ã‚’å–å¾—
git pull && make migrate && make generate-schema

# 2. é–‹ç™ºä¸­: ã‚¹ã‚­ãƒ¼ãƒç¢ºèª
cat supabase/SCHEMA.md

# 3. ã‚³ãƒ¼ãƒ‰æ›¸ã: å‹å®šç¾©ã‚’ä½¿ç”¨
import { Database } from './supabase/types';
```

### å‹å®šç¾©ã®æ´»ç”¨

```typescript
// apps/workers/src/index.ts
import { Database } from '../../../supabase/types';

const supabase = createClient<Database>(
  SUPABASE_URL,
  SUPABASE_KEY
);

// å‹å®‰å…¨ãªã‚¯ã‚¨ãƒª
const { data } = await supabase
  .from('users')  // å‹è£œå®ŒãŒåŠ¹ã
  .select('id, email, display_name')  // ã‚«ãƒ©ãƒ åã‚‚è£œå®Œã•ã‚Œã‚‹
  .limit(10);
```

---

## ğŸ§ª å‹•ä½œç¢ºèª

### ã‚¹ã‚­ãƒ¼ãƒãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã‚‹ã‹ç¢ºèª

```bash
# 1. ã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆ
make generate-schema

# 2. ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
ls -la supabase/

# 3. å†…å®¹ç¢ºèª
cat supabase/SCHEMA.md
```

---

## ğŸ“‹ ã‚ˆãã‚ã‚‹è³ªå•

### Q: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒ100å€‹ã«ãªã£ãŸã‚‰ï¼Ÿ

A: ã‚¹ã‚­ãƒ¼ãƒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆã—ã¦ã€å¤ã„ã‚‚ã®ã¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã€‚
   æ–°è¦ãƒ¡ãƒ³ãƒãƒ¼ã¯æœ€æ–°ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰é–‹å§‹ã€‚

### Q: ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚¹ã‚­ãƒ¼ãƒã‚’æŒã¡ãŸããªã„ï¼Ÿ

A: `make generate-schema` ã‚’æ¯å›å®Ÿè¡Œã™ã‚‹ã‹ã€
   CI/CDã§è‡ªå‹•ç”Ÿæˆã—ã¦Gitã«å«ã‚ã‚‹é¸æŠè‚¢ã‚‚ã‚ã‚Šã¾ã™ã€‚

### Q: å‹å®šç¾©ã¯å¿…é ˆï¼Ÿ

A: ãªãã¦ã‚‚å‹•ä½œã—ã¾ã™ãŒã€å‹å®‰å…¨æ€§ã®ãŸã‚ã«å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚

---

## ğŸ‰ ã¾ã¨ã‚

### âœ… ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆã‚’æŒã¤æ–¹æ³•

```bash
make generate-schema
```

- `schema.json` - JSONå½¢å¼
- `types.ts` - TypeScriptå‹å®šç¾©
- `SCHEMA.md` - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†

- å°ã•ãé »ç¹ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã—ãªã„
- åŠå¹´ã«1å›ã‚¹ã‚­ãƒ¼ãƒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ

### âœ… å®Ÿé‹ç”¨

```bash
# æœã‚¤ãƒ
git pull && make migrate && make generate-schema

# é–‹ç™ºä¸­
cat supabase/SCHEMA.md  # ã‚¹ã‚­ãƒ¼ãƒç¢ºèª

# ã‚³ãƒ¼ãƒ‰æ›¸ã
import { Database } from './supabase/types';  # å‹å®‰å…¨
```

**å®Œç’§ãªç®¡ç†ä½“åˆ¶ã§ã™ï¼** ğŸš€
